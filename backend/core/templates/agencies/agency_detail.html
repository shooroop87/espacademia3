{% extends 'base.html' %}
{% load static i18n %}

{% block title %}{{ developer.name }} - espacademia{% endblock %}
{% block meta_description %}{{ developer.meta_description|default:developer.short_description }}{% endblock %}

{% block content %}
<div class="main-content">
    <div class="properties-details">
        <div class="tf-container tf-spacing-1">

            <!-- Breadcrumbs + Title -->
            <div class="properties-title v2">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap_12">
                    <div>
                        <ul class="breadcrumb style-1 text-button fw-4 mb_4">
                            <li><a href="/">Главная</a></li>
                            <li><a href="{% url 'index' %}#category-luchshie-developery">Рейтинги девелоперов</a></li>
                            <li>{{ developer.name }}</li>
                        </ul>
                        <h3>{{ developer.name }}</h3>
                    </div>
                    <div class="d-flex align-items-center gap_8">
                        <span class="text-body-1">Рейтинг</span>
                        <span class="h5 text_primary-color">{{ developer.rating }}</span>
                        <ul class="ratings d-flex">
                            {% for i in "12345" %}
                            <li><i class="icon-favorite_major {% if forloop.counter > developer.rating|floatformat:0|add:0 %}text-muted{% endif %}" style="color: #f5a623;"></i></li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Main Card -->
            <div class="box-sellers style-2 tf-spacing-8">
                <div class="row">
                    <div class="col-lg-4 col-md-5">
                        <div class="developer-logo text-center p-4">
                            {% if developer.logo %}
                            <img src="{{ developer.logo.url }}" alt="{{ developer.name }}" style="max-width: 250px; max-height: 200px;">
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-lg-8 col-md-7">
                        <!-- Highlights -->
                        <ul class="developer-highlights mb_24">
                            {% if developer.founded_year %}
                            <li class="d-flex align-items-start gap_12 mb_16">
                                <span class="highlight-dot" style="width: 10px; height: 10px; background: #11E226; border-radius: 50%; margin-top: 6px; flex-shrink: 0;"></span>
                                <span class="text-body-2">{{ developer.tagline|default:"Девелопер и управляющая компания" }}, основанная в {{ developer.founded_year }} году</span>
                            </li>
                            {% endif %}
                            {% for highlight in developer.highlights.all %}
                            <li class="d-flex align-items-start gap_12 mb_16">
                                <span class="highlight-dot" style="width: 10px; height: 10px; background: #11E226; border-radius: 50%; margin-top: 6px; flex-shrink: 0;"></span>
                                <span class="text-body-2">{{ highlight.text }}</span>
                            </li>
                            {% endfor %}
                        </ul>

                        <!-- Rating Bars -->
                        <div class="rating-bars mb_24">
                            <div class="rating-bar-item d-flex align-items-center gap_16 mb_12">
                                <span class="text-body-default" style="min-width: 140px;">Срок сдачи</span>
                                <div class="progress flex-grow-1" style="height: 8px; background: #e9ecef; border-radius: 4px;">
                                    <div class="progress-bar" style="width: {{ developer.rating_deadline|default:80 }}%; background: #11E226; border-radius: 4px;"></div>
                                </div>
                                <span class="text-button fw-6" style="min-width: 30px;">{{ developer.rating_deadline_display|default:"4/5" }}</span>
                            </div>
                            <div class="rating-bar-item d-flex align-items-center gap_16 mb_12">
                                <span class="text-body-default" style="min-width: 140px;">Премиальность</span>
                                <div class="progress flex-grow-1" style="height: 8px; background: #e9ecef; border-radius: 4px;">
                                    <div class="progress-bar" style="width: {{ developer.rating_premium|default:100 }}%; background: #11E226; border-radius: 4px;"></div>
                                </div>
                                <span class="text-button fw-6" style="min-width: 30px;">{{ developer.rating_premium_display|default:"5/5" }}</span>
                            </div>
                            <div class="rating-bar-item d-flex align-items-center gap_16 mb_12">
                                <span class="text-body-default" style="min-width: 140px;">Поддержка</span>
                                <div class="progress flex-grow-1" style="height: 8px; background: #e9ecef; border-radius: 4px;">
                                    <div class="progress-bar" style="width: {{ developer.rating_support|default:100 }}%; background: #11E226; border-radius: 4px;"></div>
                                </div>
                                <span class="text-button fw-6" style="min-width: 30px;">{{ developer.rating_support_display|default:"5/5" }}</span>
                            </div>
                            <div class="rating-bar-item d-flex align-items-center gap_16 mb_12">
                                <span class="text-body-default" style="min-width: 140px;">Качество строительства</span>
                                <div class="progress flex-grow-1" style="height: 8px; background: #e9ecef; border-radius: 4px;">
                                    <div class="progress-bar" style="width: {{ developer.rating_quality|default:100 }}%; background: #11E226; border-radius: 4px;"></div>
                                </div>
                                <span class="text-button fw-6" style="min-width: 30px;">{{ developer.rating_quality_display|default:"5/5" }}</span>
                            </div>
                        </div>

                        <!-- Stats -->
                        <div class="developer-stats d-flex gap_30 mb_24 flex-wrap">
                            <div>
                                <span class="text_secondary-color">Сдано:</span>
                                <span class="text-button fw-6 text_primary-color">{{ completed_count }} Объектов</span>
                            </div>
                            <div>
                                <span class="text_secondary-color">Строится:</span>
                                <span class="text-button fw-6 text_primary-color">{{ in_progress_count }} Объекта</span>
                            </div>
                            <div>
                                <span class="text_secondary-color">Всего:</span>
                                <span class="text-button fw-6 text_primary-color">{{ total_count }} Объектов</span>
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="d-flex gap_12 flex-wrap">
                            <a href="#reviews" class="tf-btn btn-bg-1">
                                <span class="d-flex align-items-center gap_8"><i class="icon-ChatCircleDots"></i>Оставить отзыв</span>
                                <span class="bg-effect"></span>
                            </a>
                            <a href="#" class="tf-btn btn-bg-2" data-bs-toggle="modal" data-bs-target="#presentationModal">
                                <span class="d-flex align-items-center gap_8"><i class="icon-FilePdf"></i>Получить презентацию</span>
                                <span class="bg-effect"></span>
                            </a>
                            {% if developer.website %}
                            <a href="{{ developer.website }}" target="_blank" class="tf-btn">
                                <span>Сайт компании <i class="icon-ArrowUpRight"></i></span>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- Reviews Section -->
            <div class="section-testimonials tf-spacing-8" id="reviews">
                <div class="heading-section mb_48">
                    <h3>Отзывы</h3>
                </div>
                
                {% if reviews %}
                <div class="sw-layout">
                    <div class="swiper" data-preview="3" data-tablet="2" data-mobile="1" data-space-lg="30" data-space-md="20" data-space="15">
                        <div class="swiper-wrapper">
                            {% for review in reviews %}
                            <div class="swiper-slide">
                                <div class="testimonial-item">
                                    <div>
                                        <div class="d-flex align-items-center justify-content-between mb_12">
                                            {% if developer.logo %}
                                            <img src="{{ developer.logo.url }}" alt="{{ developer.name }}" style="max-height: 30px;">
                                            {% endif %}
                                            <div class="d-flex align-items-center gap_4">
                                                <span class="text-body-default">{{ developer.rating }}</span>
                                                <i class="icon-favorite_major" style="color: #f5a623;"></i>
                                            </div>
                                        </div>
                                        <p class="text_primary-color text-body-4 mb_23">{{ review.text|truncatewords:30 }}</p>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="text_secondary-color">Отзыв {{ developer.name }}</span>
                                        <span class="text-caption-1 text_secondary-color">{{ review.created_at|date:"d.m.Y" }}</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="sw-dots style-1 sw-pagination-layout justify-content-center d-flex mt_24"></div>
                    </div>
                </div>
                {% else %}
                <p class="text_secondary-color">Отзывов пока нет. Будьте первым!</p>
                {% endif %}
            </div>
            <!-- Description Section -->
            <div class="properties-description tf-spacing-8">
                <div class="row mb_40">
                    <div class="col-lg-2 col-md-3">
                        <h6 class="text_primary-color mb_12">{{ developer.name }}</h6>
                    </div>
                    <div class="col-lg-10 col-md-9">
                        <p class="text-body-2">{{ developer.description|safe }}</p>
                    </div>
                </div>
                
                {% if developer.innovations %}
                <div class="row mb_40">
                    <div class="col-lg-2 col-md-3">
                        <h6 class="text_primary-color mb_12">Инновации и устойчивое развитие</h6>
                    </div>
                    <div class="col-lg-10 col-md-9">
                        <p class="text-body-2">{{ developer.innovations|safe }}</p>
                    </div>
                </div>
                {% endif %}
                
                {% if developer.services %}
                <div class="row mb_40">
                    <div class="col-lg-2 col-md-3">
                        <h6 class="text_primary-color mb_12">Сервис и философия</h6>
                    </div>
                    <div class="col-lg-10 col-md-9">
                        <p class="text-body-2">{{ developer.services|safe }}</p>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Properties Section -->
            {% if properties %}
            <div class="tf-spacing-8">
                <div class="heading-section mb_30">
                    <h4>Объекты {{ developer.name }}</h4>
                </div>
                <div class="tf-grid-layout lg-col-3 md-col-2">
                    {% for property in properties %}
                    <div class="card-house style-default hover-image">
                        <div class="img-style mb_20">
                            {% if property.get_main_image %}
                            <img loading="lazy" src="{{ property.get_main_image }}" width="410" height="308" alt="{{ property.name }}">
                            {% endif %}
                            <div class="wrap-tag d-flex gap_8 mb_12">
                                {% if property.property_type %}
                                <div class="tag categoreis text-button-small fw-6 text_primary-color">{{ property.property_type.name }}</div>
                                {% endif %}
                                {% if property.construction_status == 'completed' %}
                                <div class="tag text-button-small fw-6" style="background: #28a745; color: #fff;">Сдан</div>
                                {% endif %}
                            </div>
                            <a href="{% url 'properties:detail' property.slug %}" class="overlay-link"></a>
                        </div>
                        <div class="content">
                            <a href="{% url 'properties:detail' property.slug %}" class="title mb_8 h5 link text_primary-color">{{ property.name }}</a>
                            <p class="mb_8"><i class="icon-MapPin"></i> {{ property.location }}</p>
                            <ul class="info d-flex">
                                {% if property.rooms %}
                                <li class="d-flex align-items-center gap_8 text-title text_primary-color fw-6">
                                    <i class="icon-Bed"></i>{{ property.rooms }}
                                </li>
                                {% endif %}
                                {% if property.area %}
                                <li class="d-flex align-items-center gap_8 text-title text_primary-color fw-6">
                                    <i class="icon-Ruler"></i>{{ property.area }} м²
                                </li>
                                {% endif %}
                            </ul>
                            <div class="mt_12 text-caption-1 text_secondary-color">Сдача: {{ property.completion_status }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}